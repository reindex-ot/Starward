# アプリケーションの構成

バージョン 0.8.0から、Starward は設定の保存にレジストリを使用しなくなりました。その代わりにファイルとデータベースを使用するようになり、デバイス間でのアプリケーション全体の移行が容易になりました。ファイル構成が以下の条件になっていない場合は、レジストリを使用します。

```
│ config.ini
│ starward.exe
│ version.ini
│
└─ app-0.8.0
   │ Starward.exe
   ...
```

大丈夫です、心配はしないで。GitHub のリリースからダウンロードをしたファイルは間違いなくこの条件を満たしています。コードを引っ張ってローカル上でデバッグをするときのみ、レジストリを使用して構成を保存します。

## config.ini

`config.ini` ファイルは 2 つの設定項目のみになります:

```ini
# コンソール出力ロギングを有効化するかどうか True/False
EnableConsole=False
# ユーザーフォルダーの場所
UserDataFolder=.
```

`UserDataFolder` はユーザーデータのフォルダーです。この値が存在しない場合は、アプリケーションは起動時にようこそページを表示します。`UserDataFolder` がフォルダー自体、または `config.ini` がサブフォルダーに設定されている場合に**相対パス**を使用する事ができます。 例えば `.` (ドット 1 つ)は現在のフォルダーを指します。それ以外の場合は、**絶対パス**を使用してください。また、 `/` (スラッシュ) と `\` (バックスラッシュ)を使用する事が可能です。

注意: `config.ini` ファイルはアプリケーションフォルダーの直下に配置しなければなりません

## データベース

上記の 2つを除くすべての設定項目は、ユーザーデータフォルダー内のデータベース `StarwardDatabase.db` に保存されます。このファイルは SQLite データベースなので [DB Browser for SQLite](https://sqlitebrowser.org/) などのツールで編集が可能です。

データベースにはアプリケーションの設定項目を保持する `Setting` という名前のテーブルがあり、以下のキーと値のテキストの構造になっています。

```sql
CREATE TABLE Setting
(
    Key TEXT NOT NULL PRIMARY KEY.
    Value TEXT
).
```

アプリケーション内の設定項目には `ASettingKey` というパスカルケースの命名規則を用いた静的設定項目と `a_setting_key` というパスカルケースの命名規則を用いた静的設定項目があり、各ゲームのリージョンに対応する値を示しています。

## ゲームのリージョン

Starward は `enum GameBiz` を使用しゲームのリージョンを定義します。 `StarRail` のような完全なゲーム名を使用する場合はコメントで指定を行ないます。

| キー               | 値 | コメント                                 |
| ----------------- | ----- | --------------------------------------- |
| None              | 0     | デフォルト値                           |
| All               | 1     | すべて                                     |
| **GenshinImpact** | 10    | 原神                          |
| hk4e_cn           | 11    | 原神 (中国)         |
| hk4e_global       | 12    | 原神 (グローバル)                  |
| hk4e_cloud        | 13    | 原神 - クラウド版 (中国) |
| **StarRail**      | 20    | 崩壊:スターレイル                      |
| hkrpg_cn          | 21    | 崩壊:スターレイル (中国)             |
| hkrpg_global      | 22    | 崩壊:スターレイル (グローバル)                      |
| **Honkai3rd**     | 30    | 崩壊3rd                              |
| bh3_cn            | 31    | 崩壊3rd (中国)             |
| bh3_global        | 32    | 崩壊3rd (グローバル)                     |
| bh3_jp            | 33    | 崩壊3rd (日本)                      |
| bh3_kr            | 34    | 崩壊3rd (韓国)                      |
| bh3_overseas      | 35    | 崩壊3rd (東南アジア)             |
| bh3_tw            | 36    | 崩壊3rd (台湾/香港/マカオ)                   |

## 静的設定

以下の表のデータ型の `種類` は C# の式を使用しており、 `-` はデフォルト値にします。

| キー                             | 種類    | デフォルト値 | コメント                                                                                                                                                          |
| ------------------------------- | ------- | ------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Language                        | string? | -             | アプリケーションの言語を設定します。(`zh-CN` `en-US` など)空欄の場合はシステムの設定に従うようにします。                                                   |
| WindowSizeMode                  | int     | -             | アプリのウィンドウサイズを指定します。 0 - 標準 1 - 最小                                                                                                           |
| ApiCDNIndex                     | int     | -             | API CDN オプションを指定します。 0 - CloudFlare、 1 - GitHub、 2 - jsDelivr                                                                                                        |
| EnablePreviewRelease            | bool    | -             | プレビューリリースチャンネルに参加するかどうか。                                                                                                                     |
| IgnoreVersion                   | string? | -             | アップデートのバージョン通知を無視します。新しいバージョンは、この値より大きい場合のみ通知を継続します。                                     |
| EnableBannerAndPost             | bool    | -             | ランチャーページにゲームのお知らせを表示します。                                                                                                                    |
| IgnoreRunningGame               | bool    | -             | 実行中のゲームを無視にすると `ゲームを実行中` の表示がされなくなります。                                                                     |
| SelectGameBiz                   | GameBiz | -             | 最後に選択されたゲームのリージョン。                                                                                                                                   |
| ShowNoviceGacha                 | bool    | -             | 初心者ガチャの状態を表示します。                                                                                                                                         |
| GachaLanguage                   | string? | -             | ガチャの記録に使用する言語を取得します。デフォルトではゲーム内の言語になります。                                                                                    |
| EnableDynamicAccentColor        | bool    | -             | ダイナミックテーマカラーは背景画像から計算された色になります。オフの場合は、システムテーマカラーが使用されます。                                       |
| AccentColor                     | string? | -             | 起動時の計算量を減らすためにキャッシュをされたダイナミックテーマカラーを使用します。 `#ARBG#ARBG`: 前者は背景色、後者はテキスト色になります。 |
| VideoBgVolume                   | int     | 100           | 背景の動画の音量。 `(0 - 100)`                                                                                                                   |
| PauseVideoWhenChangeToOtherPage | bool    | -             | 非ランチャーページを切り替えたときに動画を一時停止します。                                                                                                             |
| UseOneBg                        | bool    | -             | すべてのゲームのリージョンで同じ背景を使用します。通常では、動画背景を使用するとき有効化されます。                                                                       |
| AcceptHoyolabToolboxAgreement   | bool    | -             | HoYoLAB ツールボックスページの免責事項に同意をします。                                                                                                               |

## 動的設定

動的設定はゲームのリージョンごとに設定値が事なります。設定キーの末尾にゲームのリージョンが付加されます。例えば設定項目の `custom_bg` は グローバル版原神になると `custom_gb_hk4e_global` となります。

| キー                          | 種類    | デフォルト値 | コメント                                                                                                                            |
| ---------------------------- | ------- | ------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| bg                           | string? | -             | 公式の背景画像のファイル名でユーザーデータフォルダーの`bg`のサブフォルダーに格納されています。                                |
| custom_bg                    | string? | -             | カスタム背景画像は、画像はファイル名、動画はフルパスになります。                                            |
| enable_custom_bg             | bool    | -             | カスタム背景を有効化するかどうか。                                                                                               |
| install_path                 | string? | -             | 公式ランチャーのフォルダーではなく、ゲームがインストールされているフォルダー。                                                          |
| enable_third_party_tool      | bool    | -             | サードパーティ製ツールを有効化にして代わりにゲームを開始するかどうかを設定します。                                                                          |
| third_party_tool_path        | string? | -             | サードパーティツールのファイルのパス。                                                                                          |
| start_argument               | string? | -             | ゲーム開始時の引数。                                                                                                            |
| last_gacha_uid               | long    | -             | ガチャの記録ページで最後に選択をされたUID。                                                                                       |
| last_region_of               | GameBiz | -             | 最後に選択をされたリージョン。アプリ上部のクイック切り替えに使用され、最後にゲームのフルネームを付加します。 |
| last_select_game_record_role | long    | -             | HoYoLABツールボックスのページでゲームロールの最後に選択をされたUID。                                                                        |
